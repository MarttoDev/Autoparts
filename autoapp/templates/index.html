{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AutoParts - Tienda</title>
  <link rel="stylesheet" href="{% static 'autoapp/styles.css' %}" />
</head>
<body>

<header>
  <div class="logo">AutoParts</div>
  <ul style="list-style: none; display: flex; justify-content: flex-end; gap: 1rem; margin: 0;">
    {% if user.is_authenticated %}
      <li style="color: white;">Hola, {{ user.username }}</li>
      <form method="post" action="{% url 'logout' %}" style="display: inline;">
        {% csrf_token %}
        <button type="submit" style="background: none; border: none; color: white; cursor: pointer;">
          Cerrar sesión
        </button>
      </form>
    {% else %}
      <li><a href="{% url 'login' %}" style="color: white; text-decoration: none;">Iniciar sesión</a></li>
      <li><a href="{% url 'register' %}" style="color: white; text-decoration: none;">Registrarse</a></li>
    {% endif %}
  </ul>
  <a href="{% url 'cart_detail' %}" class="cart">
    🛒 ({{ cart_item_count }})
  </a>
</header>

<main style="display: flex; gap: 2rem; padding: 1rem;">

  <!-- Sidebar filtros -->
  <aside id="filtros" style="width: 250px; border: 1px solid #ccc; padding: 1rem; border-radius: 8px; background: #f8f8f8;">
    <form method="get">
        <h3>Filtrar por categoría</h3>
        <ul style="list-style: none; padding-left: 0;">
          {% for categoria in categorias %}
          <li>
            <label>
              <input type="checkbox" name="categorias" value="{{ categoria.id }}"
                {% if categoria.id|stringformat:"s" in categorias_filtradas %}checked{% endif %}>
              {{ categoria.nombre }}
            </label>
          </li>
          {% endfor %}
        </ul>


      <h3>Filtrar por precio</h3>
      <div>
        <label for="precio_min">Precio mínimo:</label>
        <input type="number" name="precio_min" id="precio_min" min="0" step="0.01" value="{{ request.GET.precio_min }}">
      </div>
      <div>
        <label for="precio_max">Precio máximo:</label>
        <input type="number" name="precio_max" id="precio_max" min="0" step="0.01" value="{{ request.GET.precio_max }}">
      </div>
      <button type="submit" style="margin-right: 1rem;">Aplicar filtros</button>
      <a href="{% url 'index' %}" style="text-decoration: none; color: var(--burdeos); font-weight: 600;">Limpiar filtros</a>

    </form>
  </aside>

  <!-- Productos -->
  <section id="productos" class="productos" style="flex: 1; display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1.5rem;">
    {% for producto in productos %}
    <div class="producto" style="border: 1px solid #ccc; border-radius: 8px; padding: 1rem; display: flex; flex-direction: column; align-items: center; background: white;">
      <div class="imagen" style="width: 100%; height: 150px; display: flex; justify-content: center; align-items: center; margin-bottom: 1rem; overflow: hidden; border-radius: 4px; background: #eee;">
        {% if producto.imagen %}
          <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="producto-img" style="max-width: 100%; max-height: 100%; object-fit: contain;">
        {% else %}
          <div class="img-placeholder" style="color: #777; font-style: italic;">Sin imagen</div>
        {% endif %}
      </div>
      <h3>{{ producto.nombre }}</h3>
      <p>{{ producto.marca }}</p>
      <div class="precio">${{ producto.precio }}</div>
      <p>Stock: {{ producto.stock }}</p>
      <form action="{% url 'add_to_cart' producto.id %}" method="post" style="margin-top: auto;">
        {% csrf_token %}
        <button type="submit">Añadir al carrito</button>
      </form>
    </div>
    {% empty %}
    <p>No hay productos disponibles.</p>
    {% endfor %}
  </section>

</main>

<footer style="text-align: center; padding: 1rem; background: #222; color: white;">
  &copy; 2025 AutoParts. Todos los derechos reservados.
</footer>

</body>
</html>
